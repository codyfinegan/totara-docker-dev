version: "3.7"
services:

  nginx:
    # image: totara/docker-dev-nginx
    build: ./nginx
    container_name: totara_nginx
    environment:
      - TZ=${TIME_ZONE}
      - REMOTE_DATA
      - REMOTE_SRC
    ports:
      # - "80:80"
      # - "443:443"
      - "8443:8443" # ngrok only
      - "8153:8153"
      - "8154:8154"
      - "8155:8155"
      - "8156:8156"
      - "8170:8170"
      - "8171:8171"
      - "8172:8172"
      - "8173:8173"
      - "8174:8174"
      - "8180:8180"
      - "8181:8181"
      - "8253:8253"
      - "8254:8254"
      - "8255:8255"
      - "8256:8256"
      - "8270:8270"
      - "8271:8271"
      - "8272:8272"
      - "8273:8273"
      - "8274:8274"
      - "8280:8280"
      - "8281:8281"
    volumes:
      - ${LOCAL_SRC}:${REMOTE_SRC}
      - totara-data:${REMOTE_DATA}
      - ./nginx/ssl:/etc/certificates
    depends_on:
      - mailcatcher
    networks:
      totara:
        aliases:
          - totara.local
          - totara.debug
          - totara54
          - totara54.debug
          - totara54.behat
          - totara54.behat.totaralms.com
          - totara55
          - totara55.debug
          - totara55.behat
          - totara55.behat.totaralms.com
          - totara56
          - totara56.debug
          - totara56.behat
          - totara56.behat.totaralms.com
          - totara70
          - totara70.debug
          - totara70.behat
          - totara70.behat.totaralms.com
          - totara71
          - totara71.debug
          - totara71.behat
          - totara71.behat.totaralms.com
          - totara72
          - totara72.debug
          - totara72.behat
          - totara72.behat.totaralms.com
          - totara73
          - totara73.debug
          - totara73.behat
          - totara73.behat.totaralms.com
          - totara74
          - totara74.debug
          - totara74.behat
          - totara74.behat.totaralms.com
          - totara80
          - totara80.behat
          - totara80.behat.totaralms.com
          - totara81
          - totara81.behat
          - totara81.behat.totaralms.com

volumes:
  totara-data: